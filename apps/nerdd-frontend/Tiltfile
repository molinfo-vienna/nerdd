load('ext://git_resource', 'git_checkout')
load('ext://namespace', 'namespace_inject')

# checkout source code
project_name = 'nerdd-frontend'
repository_url = 'https://github.com/molinfo-vienna/{}'.format(project_name)
project_dir = '../../repos/{}'.format(project_name)
if not os.path.exists(project_dir):
    git_checkout(
        repository_url, 
        checkout_dir=project_dir
    )

# build docker image
docker_build(
    'nerdd-frontend',
    context=project_dir,
    live_update=[
        sync(project_dir, '/app')
    ],
)

# deploy yaml files
k8s_yaml(namespace_inject(kustomize('./envs/local/'), 'local'))

k8s_resource(
    'nerdd-frontend',
    port_forwards='3000:80',
    labels=['frontend']
)